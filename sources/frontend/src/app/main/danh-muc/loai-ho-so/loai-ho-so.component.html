<page-header [title]="'::DanhMucs' | abpLocalization" [description]="'::DanhMucs.LoaiHoSo' | abpLocalization">
  <div>
    <button id="export" type="button" class="btn btn-info btn-xs" (click)="onExported()">
      <i class="pi pi-download"></i>
      <span class="ms-2">Xuất dữ liệu</span>
    </button>
    <button *abpPermission="'Cts.DanhMucs.LoaiHoSo.Create'" id="upload" type="button" class="btn btn-warning btn-xs">
      <i class="pi pi-upload"></i>
      <span class="ms-2">Upload tài liệu</span>
    </button>
    <button *abpPermission="'Cts.DanhMucs.LoaiHoSo.Create'" id="create" type="button" class="btn btn-success btn-xs" (click)="createLoaiHoSo()">
      <i class="pi pi-plus"></i>
      <span class="ms-2">{{ '::CreateNew' | abpLocalization }}</span>
    </button>
  </div>
</page-header>

<div class="card">
  <div class="card-header">
    <div class="row">
      <div class="col col-md-6">
        <!-- <h5 class="card-title">
          {{'::Menu:LoaiHoSo' | abpLocalization}}
        </h5> -->
        <div class="input-group group-search">
          <span class="input-group-text pe-0">
            <i class="fas fa-search ms-1"></i>
          </span>
          <input class="form-control input-search"
            type="text"
            name="search"
            [(ngModel)]="keySearch"
            (input)="search()"
            [placeholder]="'::Search' | abpLocalization">
        </div>
      </div>
    </div>
  </div>
  <div class="card-body">
    <p-table
      [value]="loaiHoSo.items">
      <ng-template #header>
        <tr>
          <th>#</th>
          <th>{{'::MaLoaiHoSo' | abpLocalization}}</th>
          <th>{{'::TenLoaiHoSo' | abpLocalization}}</th>
          <th>{{'::TrangThai' | abpLocalization}}</th>
          <th>{{'::GhiChu' | abpLocalization}}</th>
          <th>{{'::Actions' | abpLocalization}}</th>
        </tr>
      </ng-template>
      <ng-template #body let-row let-index="rowIndex">
        <tr>
          <td>{{index + 1}}</td>
          <td>{{row.maLoaiHoSo}}</td>
          <td>{{row.tenLoaiHoSo}}</td>
          <td>
            <span *ngIf="row.trangThai === TrangThai.HoatDong" class="badge bg-success">
              {{'::Enum:TrangThai.HoatDong' | abpLocalization}}
            </span>
            <span *ngIf="row.trangThai === TrangThai.KhongHoatDong" class="badge bg-danger">
              {{'::Enum:TrangThai.KhongHoatDong' | abpLocalization}}
            </span>
          </td>
          <td>{{row.ghiChu}}</td>
          <td>
            <div ngbDropdown class="d-inline-block">
              <button
                class="btn btn-primary btn-sm"
                style="background-color: #009ef7"
                ngbDropdownToggle
              >
                <i class="pi pi-cog" style="margin-right: 20px"></i>
              </button>
              <div ngbDropdownMenu>
                <button *abpPermission="'Cts.DanhMucs.LoaiHoSo.Edit'" ngbDropdownItem (click)="editLoaiHoSo(row.id)">{{'::Edit' | abpLocalization}}</button>
                <button *abpPermission="'Cts.DanhMucs.LoaiHoSo.Delete'" ngbDropdownItem class="text-danger" (click)="deleteLoaiHoSo(row.id)">{{'::Delete' | abpLocalization}}</button>
              </div>
            </div>
          </td>
        </tr>
        
      </ng-template>
      
    </p-table>
    <div class="col col-md-12 d-flex justify-content-end">
      <div class="col col-md-4">
        <p-paginator
          [rows]="rows"
          [totalRecords]="loaiHoSo.totalCount"
          (onPageChange)="onPageChange($event)"
          [rowsPerPageOptions]="[10, 20, 30]"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Tổng cộng: {totalRecords}"
          >
        </p-paginator>
      </div>
    </div>
  </div>
</div>

<p-dialog
    [(visible)]="isModalOpen"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{ width: '480px' }"
    [baseZIndex]="1055"
    [dismissableMask]="true"
  >
  <ng-template pTemplate="header">
    <h3 class="fw-bold">{{ (selectedLoaiHoSo.id ? '::EditLoaiHoSo' : '::NewLoaiHoSo' ) | abpLocalization }}</h3>
  </ng-template>
  <ng-template pTemplate="content">
    <form [formGroup]="form" (ngSubmit)="save()">
      <div class="mb-3">
        <label class="form-label">{{'::MaLoaiHoSo' | abpLocalization}}<span class="text-danger"> *</span></label>
        <input type="text" class="form-control" formControlName="maLoaiHoSo"
          [readOnly]="selectedLoaiHoSo.id"/>
        <div
          class="text-danger mt-1"
          *ngIf="form?.get('maLoaiHoSo')?.dirty && form?.get('maLoaiHoSo')?.errors?.['maLoaiHoSoExists']"
        >
          {{'::MaLoaiHoSoExists' | abpLocalization}}
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">{{'::TenLoaiHoSo' | abpLocalization}}<span class="text-danger"> *</span></label>
        <input type="text" class="form-control" formControlName="tenLoaiHoSo"/>
      </div>
      <div class="mb-3">
        <label class="form-label">{{'::TrangThai' | abpLocalization}} <span class="text-danger"> *</span></label>
        <select class="form-control" formControlName="trangThai" id="">
          <option [ngValue]="null" selected disabled>Chọn trạng thái</option>
          <option [ngValue]="status.value" *ngFor="let status of statuses$">
            {{status.label | abpLocalization}}
          </option>
      </select>
      </div>
      <div class="mb-3">
        <label class="form-label">{{'::GhiChu' | abpLocalization}}</label>
        <textarea class="form-control" formControlName="ghiChu"></textarea>
      </div>
    </form>
  </ng-template>
  <ng-template pTemplate="footer">
    <button type="submit" class="btn btn-success" (click)="save()" [disabled]="form?.invalid">
      <i class="bi bi-check-lg"></i> Lưu
    </button>
    <button type="button" class="btn btn-danger" (click)="isModalOpen = false">
      <i class="bi bi-x-lg"></i> Đóng
    </button>
  </ng-template>
</p-dialog>

<app-export-excel-dialog
  [(visible)]="exportVisible"
  [data]="exportData"
  [columns]="exportColumns"
  [defaultFileName]="'LoaiHoSo.xlsx'"
  [defaultSheetName]="'LoaiHoSo'"
  (exported)="onExported()"
></app-export-excel-dialog>