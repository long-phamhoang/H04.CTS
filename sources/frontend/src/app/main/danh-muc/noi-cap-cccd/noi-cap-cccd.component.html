<page-header [title]="'::DanhMucs' | abpLocalization" [description]="'::DanhMucs.ChucVu' | abpLocalization">
  <div>
    <button id="export" type="button" class="btn btn-info btn-xs">
      <i class="pi pi-download"></i>
      <span class="ms-2">Xuất dữ liệu</span>
    </button>
    <button id="upload" type="button" class="btn btn-warning btn-xs">
      <i class="pi pi-upload"></i>
      <span class="ms-2">Upload tài liệu</span>
    </button>
    <button id="create" type="button" class="btn btn-success btn-xs" (click)="createNoiCapCCCD()">
      <i class="pi pi-plus"></i>
      <span class="ms-2">{{ '::CreateNew' | abpLocalization }}</span>
    </button>
  </div>
</page-header>

<div class="card">

  <div class="card-body custom-border m-3">
    <div class="input-group mb-3" style="width: 300px;">
      <input type="text" class="form-control" placeholder="Tìm kiếm..." [(ngModel)]="keyword"
        (keydown.enter)="onSearch()" />
      <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">
        <i class="fa fa-search"></i>
      </button>
    </div>
    <p-table [value]="noiCapCCCD.items" [rows]="pageSize" [lazy]="true" (onLazyLoad)="loadNoiCapCCCD($event)"
      [loading]="false" class="p-datatable-sm p-datatable-striped p-datatable-gridlines custom-header-table">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px;">#</th>
          <th pSortableColumn="name">
            {{ '::TenNoiCapCCCD' | abpLocalization }}
            <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th pSortableColumn="code">
            {{ '::MaNoiCapCCCD' | abpLocalization }}
            <p-sortIcon field="code"></p-sortIcon>
          </th>
          <th pSortableColumn="abbreviation">
            {{ '::TenVietTat' | abpLocalization }}
            <p-sortIcon field="abbreviation"></p-sortIcon>
          </th>
          <th pSortableColumn="address">
            {{ '::DiaChi' | abpLocalization }}
            <p-sortIcon field="address"></p-sortIcon>
          </th>
          <th pSortableColumn="province">
            {{ '::Province' | abpLocalization }}
            <p-sortIcon field="province"></p-sortIcon>
          </th>
          <th pSortableColumn="note">
            {{ '::GhiChu' | abpLocalization }}
            <p-sortIcon field="note"></p-sortIcon>
          </th>
          <th pSortableColumn="isActive">
            {{ '::TrangThai' | abpLocalization }}
            <p-sortIcon field="isActive"></p-sortIcon>
          </th>
          <th style="width: 150px;">{{ '::Actions' | abpLocalization }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}</td>
          <td>{{ row.name }}</td>
          <td>{{ row.code }}</td>
          <td>{{ row.abbreviation }}</td>
          <td>{{ row.address }}</td>
          <td>{{ row.province }}</td>
          <td>{{ row.note }}</td>
          <td>
            <p-toggleSwitch 
              [ngModel]="row.isActive"
              (onChange)="toggleIsActive(row, $event.checked)"
            >
            </p-toggleSwitch>
          </td>
          <td>
            <div ngbDropdown container="body" class="d-inline-block">
              <button class="btn btn-primary btn-sm dropdown-toggle" ngbDropdownToggle>
                <i class="fa fa-cog me-1"></i>
              </button>
              <div ngbDropdownMenu>
                <button ngbDropdownItem (click)="editNoiCapCCCD(row.id)">
                  {{ '::Edit' | abpLocalization }}
                </button>
                <button ngbDropdownItem (click)="delete(row.id)">
                  {{ '::Delete' | abpLocalization }}
                </button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center py-3">{{ '::NoDataFound' | abpLocalization }}</td>
        </tr>
      </ng-template>
    </p-table>
    <div class="d-flex justify-content-between align-items-center p-2">
      <div>Tổng cộng: {{ noiCapCCCD.totalCount || 0 }}</div>
      <p-paginator [rows]="pageSize" [first]="0" [totalRecords]="noiCapCCCD.totalCount || 0"
        [rowsPerPageOptions]="[5, 10, 20, 50]" (onPageChange)="loadNoiCapCCCD($event)">
      </p-paginator>
    </div>
  </div>
</div>

<!-- Modal -->
<p-dialog 
  [(visible)]="isModalOpen" 
  [modal]="true" 
  [draggable]="false" 
  [resizable]="false"
  [style]="{width: '70vw'}"
  [header]="selectedNoiCapCCCD?.id ? ('::Edit' | abpLocalization) : ('::NewNoiCapCCCD' | abpLocalization)"
  [closable]="true">
  
  <div class="modal-body">
    <form [formGroup]="form" (ngSubmit)="save()" class="needs-validation" novalidate>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="noiCapCCCD-name" class="form-label">Tên nơi cấp CCCD <span class="text-danger">*</span></label>
          <input type="text" id="noiCapCCCD-name" class="form-control" formControlName="name" maxlength="100" 
            placeholder="Tên nơi cấp CCCD"
            [class.is-invalid]="form?.controls?.name?.invalid && form?.controls?.name?.touched" />
          <div class="invalid-feedback">
            Tên nơi cấp CCCD là bắt buộc
          </div>
        </div>

        <div class="col-md-6">
          <label for="noiCapCCCD-code" class="form-label">Mã nơi cấp CCCD <span class="text-danger">*</span></label>
          <input type="text" id="noiCapCCCD-code" class="form-control" formControlName="code" maxlength="50" 
            placeholder="Mã nơi cấp CCCD"
            [class.is-invalid]="form?.controls?.code?.invalid && form?.controls?.code?.touched" />
          <div class="invalid-feedback">
            Mã nơi cấp CCCD là bắt buộc
          </div>
        </div>

        <div class="col-md-6">
          <label for="noiCapCCCD-abbreviation" class="form-label">Tên viết tắt <span class="text-danger">*</span></label>
          <input type="text" id="noiCapCCCD-abbreviation" class="form-control" formControlName="abbreviation" maxlength="50" 
            placeholder="Tên viết tắt"
            [class.is-invalid]="form?.controls?.abbreviation?.invalid && form?.controls?.abbreviation?.touched" />
          <div class="invalid-feedback">
            Tên viết tắt là bắt buộc
          </div>
        </div>

        <div class="col-md-6">
          <label for="noiCapCCCD-address" class="form-label">Địa chỉ <span class="text-danger">*</span></label>
          <input type="text" id="noiCapCCCD-address" class="form-control" formControlName="address" maxlength="200" 
            placeholder="Địa chỉ"
            [class.is-invalid]="form?.controls?.address?.invalid && form?.controls?.address?.touched" />
          <div class="invalid-feedback">
            Địa chỉ là bắt buộc
          </div>
        </div>

        <div class="col-md-6">
          <label for="noiCapCCCD-province" class="form-label">Tỉnh <span class="text-danger">*</span></label>
          <input type="text" id="noiCapCCCD-province" class="form-control" formControlName="province" maxlength="100" 
            placeholder="Tỉnh"
            [class.is-invalid]="form?.controls?.province?.invalid && form?.controls?.province?.touched" />
          <div class="invalid-feedback">
            Tỉnh là bắt buộc
          </div>
        </div>

        <div class="col-md-6">
          <label for="noiCapCCCD-isActive" class="form-label">Trạng thái <span class="text-danger">*</span></label>
          <div class="d-flex align-items-center">
            <p-toggleSwitch formControlName="isActive">
            </p-toggleSwitch>
            <span class="ms-2">{{ form?.value?.isActive ? 'Hoạt động' : 'Không hoạt động' }}</span>
          </div>
        </div>

        <div class="col-md-12">
          <label for="noiCapCCCD-note" class="form-label">Ghi chú</label>
          <textarea id="noiCapCCCD-note" class="form-control" formControlName="note" rows="3" maxlength="250"
            placeholder="Ghi chú"></textarea>
        </div>
      </div>
    </form>
  </div>

  <ng-template pTemplate="footer" #dialogFooter>
    <button type="button" class="btn btn-secondary" (click)="closeModal()">
      {{ '::Close' | abpLocalization }}
    </button>
    <button class="btn btn-primary" (click)="save()" [disabled]="form?.invalid">
      <i class="fa fa-check me-1"></i> {{ '::Save' | abpLocalization }}
    </button>
  </ng-template>
</p-dialog>
