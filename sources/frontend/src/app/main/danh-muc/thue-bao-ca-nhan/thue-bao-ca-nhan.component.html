<page-header [title]="'::DanhMucs' | abpLocalization" [description]="'::DanhMucs.ThueBaoCaNhan' | abpLocalization">
</page-header>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">{{ '::Menu:ThueBaoCaNhan' | abpLocalization }}</h5>
    <button *abpPermission="'Cts.DanhMucs.ThueBaoCaNhan.Create'" class="btn btn-primary" (click)="createthueBaoCaNhan()"
      title="{{ '::CreateNew' | abpLocalization }}">
      <i class="fa fa-plus me-1"></i> {{ '::CreateNew' | abpLocalization }}
    </button>
  </div>

  <div class="card-body p-0">
    <div class="input-group p-3">
      <input type="text" class="form-control" placeholder="{{ '::Search' | abpLocalization }}" [(ngModel)]="filterInput"
        (keydown.enter)="onSearchChange()" />
      <button class="btn btn-outline-secondary" type="button" (click)="onSearchChange()">
        <i class="fa fa-search"></i>
      </button>
    </div>
    <p-table #dataTable [value]="thueBaoCaNhans.items" [rows]="pageSize" [lazy]="true"
      (onLazyLoad)="onPageChange($event)" [loading]="true" class="p-datatable-sm p-datatable-gridlines">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px;">#</th>

          <th pSortableColumn="hoTen" >
                <div class="flex items-center gap-2">
                    {{ '::HoTen' | abpLocalization }}
                    <p-sortIcon field="hoTen" />
                </div>
            </th>
          <th>{{ '::NgaySinh' | abpLocalization }}</th>
          <th>{{ '::SoDinhDanhCaNhan' | abpLocalization }}</th>
          <th>{{ '::ToChuc' | abpLocalization }}</th>
          <th>{{ '::ChucVu' | abpLocalization }}</th>
          <th>{{ '::DiaChiThuDienTuCongVu' | abpLocalization }}</th>
          <th style="width: 150px;">{{ '::Actions' | abpLocalization }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 + page * pageSize }}</td>
          <td>{{ row.hoTen }}</td>
          <td>{{ row.ngaySinh | date:'dd/MM/yyyy' }}</td>
          <td>{{ row.soDinhDanhCaNhan }}</td>
          <td>{{ row.tenToChuc }}</td>
          <td>{{ row.tenChucVu }}</td>
          <td>{{ row.diaChiThuDienTuCongVu }}</td>
          <td>
            <div ngbDropdown container="body" class="d-inline-block">
              <button class="btn btn-primary btn-sm dropdown-toggle" ngbDropdownToggle>
                <i class="fa fa-cog me-1"></i>
              </button>
              <div ngbDropdownMenu>
                <button *abpPermission="'Cts.DanhMucs.ThueBaoCaNhan.Edit'" ngbDropdownItem
                  (click)="editThueBaoCaNhan(row.id)">
                  {{ '::Edit' | abpLocalization }}
                </button>
                <button *abpPermission="'Cts.DanhMucs.ThueBaoCaNhan.Delete'" ngbDropdownItem (click)="delete(row.id)">
                  {{ '::Delete' | abpLocalization }}
                </button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center py-3">{{ '::NoDataFound' | abpLocalization }}</td>
        </tr>
      </ng-template>
    </p-table>
    <div class="d-flex justify-content-between align-items-center p-2">
      <div>Tổng cộng: {{ thueBaoCaNhans.totalCount || 0 }}</div>
      <p-paginator [rows]="pageSize" [first]="page * pageSize" [totalRecords]="thueBaoCaNhans.totalCount || 0"
        [rowsPerPageOptions]="[5, 10, 20, 50]" (onPageChange)="onPageChange($event)">
      </p-paginator>
    </div>
  </div>
</div>

<!-- Modal -->
<abp-modal [(visible)]="isModalOpen" size="xl">
  <ng-template #abpHeader>
    <h3 class="modal-title">
      {{ selectedThueBaoCaNhan?.id ? ('::Edit' | abpLocalization) : ('::NewThueBaoCaNhan' | abpLocalization) }}
    </h3>
  </ng-template>

  <ng-template #abpBody>
    <form [formGroup]="form" (ngSubmit)="save()" class="needs-validation" novalidate>
      <div class="row g-3">

        <!-- Họ tên -->
        <div class="col-md-6">
          <label for="hoTen" class="form-label">{{ '::HoTen' | abpLocalization }}</label>
          <input type="text" id="hoTen" class="form-control" formControlName="hoTen" required maxlength="100"
            placeholder="{{ '::HoTen' | abpLocalization }}"
            [class.is-invalid]="form.controls.hoTen.invalid && form.controls.hoTen.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Ngày sinh -->
        <div class="col-md-6">
          <label for="ngaySinh" class="form-label">{{ '::NgaySinh' | abpLocalization }}</label>
          <input type="date" id="ngaySinh" class="form-control" formControlName="ngaySinh" required
            [class.is-invalid]="form.controls.ngaySinh.invalid && form.controls.ngaySinh.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Số định danh cá nhân -->
        <div class="col-md-6">
          <label for="soDinhDanhCaNhan" class="form-label">{{ '::SoDinhDanhCaNhan' | abpLocalization }}</label>
          <input type="text" id="soDinhDanhCaNhan" class="form-control" formControlName="soDinhDanhCaNhan" required
            maxlength="20" placeholder="{{ '::SoDinhDanhCaNhan' | abpLocalization }}"
            [class.is-invalid]="form.controls.soDinhDanhCaNhan.invalid && form.controls.soDinhDanhCaNhan.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Nơi cấp -->
        <div class="col-md-6">
          <label for="noiCap" class="form-label">{{ '::NoiCap' | abpLocalization }}</label>
          <input type="text" id="noiCap" class="form-control" formControlName="noiCap" required maxlength="100"
            placeholder="{{ '::NoiCap' | abpLocalization }}"
            [class.is-invalid]="form.controls.noiCap.invalid && form.controls.noiCap.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Ngày cấp -->
        <div class="col-md-6">
          <label for="ngayCap" class="form-label">{{ '::NgayCap' | abpLocalization }}</label>
          <input type="date" id="ngayCap" class="form-control" formControlName="ngayCap" required
            [class.is-invalid]="form.controls.ngayCap.invalid && form.controls.ngayCap.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Tổ chức -->
        <div class="col-md-6">
          <label for="toChucId" class="form-label">{{ '::ToChuc' | abpLocalization }}</label>
          <select id="toChucId" class="form-select" formControlName="toChucId" required
            [class.is-invalid]="form.controls.toChucId.invalid && form.controls.toChucId.touched">
            <option value="" disabled>{{ '::SelectToChuc' | abpLocalization }}</option>
            <option *ngFor="let item of toChucOptions" [value]="item.id">{{ item.name }}</option>
          </select>
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Chức vụ -->
        <div class="col-md-6">
          <label for="chucVuId" class="form-label">{{ '::ChucVu' | abpLocalization }}</label>
          <select id="chucVuId" class="form-select" formControlName="chucVuId" required
            [class.is-invalid]="form.controls.chucVuId.invalid && form.controls.chucVuId.touched">
            <option value="" disabled>{{ '::SelectChucVu' | abpLocalization }}</option>
            <option *ngFor="let item of chucVuOptions" [value]="item.id">{{ item.name }}</option>
          </select>
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Email công vụ -->
        <div class="col-md-6">
          <label for="diaChiThuDienTuCongVu" class="form-label">{{ '::EmailCongVu' | abpLocalization }}</label>
          <input type="email" id="diaChiThuDienTuCongVu" class="form-control" formControlName="diaChiThuDienTuCongVu"
            required maxlength="100" placeholder="{{ '::EmailCongVu' | abpLocalization }}"
            [class.is-invalid]="form.controls.diaChiThuDienTuCongVu.invalid && form.controls.diaChiThuDienTuCongVu.touched" />
          <div class="invalid-feedback">{{ '::ValidationRequired' | abpLocalization }}</div>
        </div>

        <!-- Tỉnh / thành phố -->
        <div class="col-md-6">
          <label for="tinhThanhPho" class="form-label">{{ '::TinhThanhPho' | abpLocalization }}</label>
          <select id="tinhThanhPho" class="form-select" formControlName="tinhThanhPho"
            (change)="onTinhThanhPhoChange($event.target.value)">
            <option value="">{{ '::SelectTinhThanhPho' | abpLocalization }}</option>
            <option *ngFor="let item of tinhThanhPhoOptions" [value]="item.id">{{ item.name }}</option>
          </select>
        </div>

        <!-- Phường / xã -->
        <div class="col-md-6">
          <label for="phuongXa" class="form-label">{{ '::PhuongXa' | abpLocalization }}</label>
          <select id="phuongXa" class="form-select" formControlName="phuongXa">
            <option value="">{{ '::SelectPhuongXa' | abpLocalization }}</option>
            <option *ngFor="let item of phuongXaOptions" [value]="item.id">{{ item.name }}</option>
          </select>
        </div>
      </div>
    </form>
  </ng-template>

  <ng-template #abpFooter>
    <button type="button" class="btn btn-secondary" abpClose>
      {{ '::Close' | abpLocalization }}
    </button>
    <button class="btn btn-primary" (click)="save()" [disabled]="form.invalid">
      <i class="fa fa-check me-1"></i> {{ '::Save' | abpLocalization }}
    </button>
  </ng-template>
</abp-modal>