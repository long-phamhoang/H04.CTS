<page-header [title]="'::DanhMucs' | abpLocalization" [description]="'::DanhMucs.XaPhuong' | abpLocalization"></page-header>

<div class="card">
  <div class="card-header">
    <div class="row">
      <div class="col col-md-6">
        <div class="d-flex gap-2">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input #searchInput type="text" class="form-control" placeholder="Tìm kiếm" (keyup)="search()" />
          </div>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-filter"></i></span>
            <select class="form-control" [(ngModel)]="tinhThanhPhoId" (change)="search()">
              <option [ngValue]="null">-- Chọn tỉnh thành phố --</option>
              <option *ngFor="let opt of tinhThanhPhoList.items" [ngValue]="opt.id">{{ opt.tenTinhThanhPho | abpLocalization }}</option>
            </select>
          </div>
        </div>
        
      </div>

      <div class="text-end col col-md-6">
        <div class="text-lg-end">
          <button *abpPermission="'Cts.DanhMucs.XaPhuong.Create'" id="create" class="btn btn-primary" type="button" (click)="createXaPhuong()">
            <i class="fa fa-plus me-1"></i>
            <span>{{ '::CreateNew' | abpLocalization }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card-body">
    <p-table
      [value]="xaPhuong.items"
      [lazy]="true"
      [rows]="pageSize"
      [first]="(page - 1) * pageSize"
      [totalRecords]="xaPhuong?.totalCount || 0"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      (onLazyLoad)="onPageChange($event)"
      paginator = "false"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px">#</th>
          <th pSortableColumn="tenXaPhuong" pSortField="tenXaPhuong">{{ '::TenXaPhuong' | abpLocalization }}</th>
          <th pSortableColumn="maXaPhuong" pSortField="maXaPhuong">{{ '::MaXaPhuong' | abpLocalization }}</th>
          <th pSortableColumn="trangThai" pSortField="trangThai">{{ '::TrangThai' | abpLocalization }}</th>
          <th pSortableColumn="ghiChu" pSortField="ghiChu">{{ '::GhiChu' | abpLocalization }}</th>
          <th style="width: 150px">{{ '::Actions' | abpLocalization }}</th>
        </tr>
      </ng-template>
  
      <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
        <tr>
          <!-- Số thứ tự -->
          <td>{{ (page - 1) * pageSize + rowIndex + 1 }}</td>
  
          <td>{{ row.tenXaPhuong }}</td>
          <td>{{ row.maXaPhuong }}</td>
          <td>{{ row.trangThai.toString() === '1' ? 'Hoạt động' : 'Không hoạt động' | abpLocalization }}</td>
          <td>{{ row.ghiChu }}</td>
          
          <td>
            <div ngbDropdown container="body" class="d-inline-block">
              <button class="btn btn-primary btn-sm dropdown-toggle" ngbDropdownToggle>
                <i class="fa fa-cog me-1"></i>
              </button>
              <div ngbDropdownMenu>
                <button *abpPermission="'Cts.DanhMucs.XaPhuong.Edit'" ngbDropdownItem (click)="editXaPhuong(row.id)">
                  {{ '::Edit' | abpLocalization }}
                </button>
                <button *abpPermission="'Cts.DanhMucs.XaPhuong.Delete'" ngbDropdownItem (click)="delete(row.id)">
                  {{ '::Delete' | abpLocalization }}
                </button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <div class="d-flex justify-content-end" >
      <div class="d-flex justify-content-end" style="margin-top: 14px;">
        Tổng cộng: {{ xaPhuong?.totalCount || 0 }}
      </div>
      <p-paginator
        [rows]="pageSize"
        [first]="(page - 1) * pageSize"
        [totalRecords]="xaPhuong?.totalCount || 0"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        (onPageChange)="onPageChange($event)"
      >
      </p-paginator>
    </div>
  </div>
  
</div>

<abp-modal [(visible)]="isModalOpen">
    <ng-template #abpHeader>    
        <h3>{{ (selectedXaPhuong.id ? '::Sửa Xã/Phường' : '::Thêm mới Xã/Phường' ) | abpLocalization }}</h3>
    </ng-template>

    <ng-template #abpBody>
        <form [formGroup]="form" (ngSubmit)="save()">
          <div class="mt-2">
            <label for="tinhThanhPhoId">{{ '::TinhThanhPho' | abpLocalization }}</label><span> * </span>
            <select class="form-control" id="tinhThanhPhoId" formControlName="tinhThanhPhoId">
              <option *ngFor="let opt of tinhThanhPhoList.items" [ngValue]="opt.id">
                {{ opt.tenTinhThanhPho | abpLocalization }}
              </option>
            </select>
          </div>
            <div class="mt-2">
                <label for="tenXaPhuong">{{ '::TenXaPhuong' | abpLocalization }}</label><span> * </span>
                <input type="text" class="form-control" id="tenXaPhuong" formControlName="tenXaPhuong" />
            </div>
            <div class="mt-2">
                <label for="maXaPhuong">{{ '::MaXaPhuong' | abpLocalization }}</label><span> * </span>
                <input type="text" class="form-control" id="maXaPhuong" formControlName="maXaPhuong" />
            </div>
            <div class="mt-2">
                <label for="trangThai">{{ '::TrangThai' | abpLocalization }}</label><span> * </span>
                <select class="form-control" id="trangThai" formControlName="trangThai">
                    <option *ngFor="let opt of trangThaiOptions" [ngValue]="opt.value">
                        {{ opt.key | abpLocalization }}
                      </option>
                  </select>
            </div>
            <div class="mt-2">
                <label for="ghiChu">{{ '::GhiChu' | abpLocalization }}</label>
                <textarea class="form-control" id="ghiChu" formControlName="ghiChu"></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-2">{{ '::Save' | abpLocalization }}</button>
        </form>
    </ng-template>
</abp-modal>